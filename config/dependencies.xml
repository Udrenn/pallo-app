<?xml version="1.0" encoding="UTF-8"?>
<container>
    <dependency interface="pallo\library\decorator\Decorator" class="pallo\library\decorator\DateFormatDecorator" id="date.format" />
    
    <dependency interface="pallo\library\decorator\Decorator" class="pallo\library\decorator\LogMessageDecorator" id="log.message">
		<call method="setDateDecorator">
		    <argument name="dateDecorator" type="dependency">
		        <property name="interface" value="pallo\library\decorator\Decorator" />
		        <property name="id" value="date.format" />
		    </argument>
		</call>
        <call method="setMemoryDecorator">
            <argument name="memoryDecorator" type="dependency">
                <property name="interface" value="pallo\library\decorator\Decorator" />
                <property name="id" value="storage.size" />
            </argument>
        </call>
    </dependency>
    
    <dependency interface="pallo\library\decorator\Decorator" class="pallo\library\decorator\StorageSizeDecorator" id="storage.size" />
    
    <dependency interface="pallo\library\decorator\Decorator" class="pallo\library\decorator\VariableDecorator" id="variable" />

    <dependency interface="pallo\library\log\listener\LogListener" class="pallo\library\log\listener\FileLogListener" id="file">
        <call method="__construct">
            <argument name="fileName" type="parameter">
                <property name="key" value="log.file" />
            </argument>
        </call>
        <call method="setFileTruncateSize">
            <argument name="size" type="parameter">
                <property name="key" value="log.truncate" />
                <property name="default" value="1024" />
            </argument>
        </call>
        <call method="setLevel">
            <argument name="level" type="parameter">
                <property name="key" value="log.level" />
            </argument>
        </call>
        <call method="setLogMessageDecorator">
            <argument name="logMessageDecorator" type="dependency">
                <property name="interface" value="pallo\library\decorator\Decorator" />
                <property name="id" value="log.message" />
            </argument>
        </call>
    </dependency>

    <dependency interface="pallo\library\log\Log" class="pallo\library\log\Log" id="app">
        <call method="setClient">
            <argument name="client" type="call">
                <property name="interface" value="pallo\library\system\System" />
                <property name="method" value="getClient" />
            </argument>
        </call>
        <call method="addLogListener">
            <argument name="listener" type="dependency">
                <property name="interface" value="pallo\library\log\listener\LogListener" />
                <property name="id" value="file" />
            </argument>
        </call>
        <call method="logDebug">
            <argument name="title" type="scalar">
                <property name="value" value="----------" />
            </argument>
            <argument name="source" type="scalar">
                <property name="value" value="app" />
            </argument>
        </call>
    </dependency>    

    <dependency interface="pallo\library\event\loader\io\EventListenerIO" class="pallo\app\event\loader\io\ConfigEventListenerIO" id="config">
        <call method="__construct">
            <argument name="path" type="scalar">
                <property name="value" value="config" />
            </argument>
        </call>
    </dependency>

    <dependency interface="pallo\library\event\loader\io\EventListenerIO" class="pallo\library\event\loader\io\ChainedEventListenerIO" id="chain">
        <call method="addEventListenerIO">
            <argument name="eventListenerIO" type="dependency">
                <property name="interface" value="pallo\library\event\loader\io\EventListenerIO" />
                <property name="id" value="config" />
            </argument>
        </call>
    </dependency>

    <dependency interface="pallo\library\event\loader\EventLoader" class="pallo\app\event\loader\DependencyEventLoader" id="dependency">
        <call method="__construct">
            <argument name="io" type="dependency">
                <property name="interface" value="pallo\library\event\loader\io\EventListenerIO" />
                <property name="id" value="chain" />
            </argument>
        </call>
    </dependency>
    
    <dependency interface="pallo\library\event\loader\EventLoader" class="pallo\library\event\loader\ChainedEventLoader" id="chain">
        <call method="addEventLoader">
            <argument name="eventLoader" type="dependency">
                <property name="interface" value="pallo\library\event\loader\EventLoader" />
                <property name="id" value="dependency" />
            </argument>
        </call>
    </dependency>

    <dependency interface="pallo\library\event\EventManager" class="pallo\app\event\LoggedEventManager" id="app">
        <call method="__construct">
            <argument name="invoker" type="dependency">
                <property name="interface" value="pallo\library\reflection\Invoker" />
            </argument>
        </call>
        <call method="setEventLoader">
            <argument name="eventLoader" type="dependency">
                <property name="interface" value="pallo\library\event\loader\EventLoader" />
                <property name="id" value="chain" />
            </argument>
        </call>
        <call method="setLog">
            <argument name="log" type="dependency">
                <property name="interface" value="pallo\library\log\Log" />
            </argument>
        </call>
        <call method="setValueDecorator">
            <argument name="log" type="dependency">
                <property name="interface" value="pallo\library\decorator\Decorator" />
                <property name="id" value="variable" />
            </argument>
        </call>
    </dependency>
</container>